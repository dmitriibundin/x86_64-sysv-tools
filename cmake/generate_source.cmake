file(MAKE_DIRECTORY ${X86T_AUTOGENERATED_SRC_DIR_ASM_NASM_INC})

set(X86T_ASM_NASM_INC_SUFFIX "inc")

set(X86T_AUTOGENERATED_OUTPUT_SOURCES)

set(X86T_AUTOGENERATED_C_ASM_INC_PAIRS)
foreach(C_HEADER ${X86T_C_HEADERS_CONVERT_NASM})
    get_filename_component(C_HEADER_FILENAME ${C_HEADER} NAME_WE)
    set(NASM_OUTPUT_SOURCE ${X86T_AUTOGENERATED_SRC_DIR_ASM_NASM_INC}/${C_HEADER_FILENAME}.${X86T_ASM_NASM_INC_SUFFIX})
    set(X86T_AUTOGENERATED_OUTPUT_SOURCES ${X86T_AUTOGENERATED_OUTPUT_SOURCES} ${NASM_OUTPUT_SOURCE})
    set(X86T_AUTOGENERATED_C_ASM_INC_PAIRS ${X86T_AUTOGENERATED_C_ASM_INC_PAIRS} ${C_HEADER}:${NASM_OUTPUT_SOURCE})
endforeach()

TODO: Add check that python3.7 is installed
add_custom_command(
    OUTPUT ${X86T_AUTOGENERATED_OUTPUT_FILES} 
    COMMAND python3.7 ${CMAKE_CURRENT_SOURCE_DIR}/cnasm_conv.py ${X86T_AUTOGENERATED_OUTPUT_FILES} 
    DEPENDS 
)